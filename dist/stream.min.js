define(function(){var t=Array.prototype.reduce,g=function(a){return a.bind.apply(a,arguments)},n=g(g,function(a){return a}),l=function(a,c){return{first:a,rest:c}},k=function(a,c){var d;return l(a,function(){return void 0===d?d=c.apply(void 0,arguments):d})},i=function(a,c){return null===a?c():k(a.first,g(i,h(a),c))},u=function(a,c){return i(a,n(c))},m=function(a){return null===a?a:i(a.first,g(m,h(a)))},p=function(a,c,d){return c>=d?null:k(a[c],g(p,a,c+1,d))},h=function(a){return a.rest(a.first)},
q=function(a,c){for(var d=0;null!==c;)a(c.first,d),d+=1,c=h(c)},r=function(a,c,d){q(function(b,d){return c=a(c,b,d)},d);return c},v=g(function c(d,b,e,f){return null===f?e:b(c(d+1,b,e,h(f)),f.first,d)},0),w=function(c,d){c.push(d);return c},s=g(function d(b,e,f){return null===f?f:k(e(f.first,b),g(d,b+1,e,h(f)))},0),x=g(function b(e,f,j){for(;null!==j;){var i=j.first;if(f(i,e))return k(i,g(b,e+1,f,h(j)));e+=1;j=h(j)}return j},0);return{end:null,stream:l,memoStream:k,cons:function(b,e){return l(b,n(e))},
append:function(){return t.call(arguments,u,null)},appendz:i,concat:m,from:function(b){return void 0===b?null:p(b,0,b.length)},first:function(b){return b.first},rest:h,isEmpty:function(b){return null===b},isStream:function(b){return b&&b.hasOwnProperty("first")&&b.hasOwnProperty("rest")},forEach:q,foldl:r,foldr:v,toArray:function(b){return r(w,[],b)},map:s,filter:x,bind:function(b,e){return m(s(b,e))}}});
