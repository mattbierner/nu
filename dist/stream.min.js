define(function(){var t=Function.prototype.call.bind(Array.prototype.reduce),h=function(b){return b.bind.apply(b,arguments)},p=function(b){return function(){return b}},m=function(b,e){return{first:b,rest:e}},l=function(b,e){var d;return m(b,function(){void 0===d&&(d=e.apply(this,arguments));return d})},i=function(b){return b.rest(b.first)},j=function(b,e){return null===b?e():l(b.first,h(j,i(b),e))},u=function(b,e){return j(b,p(e))},n=function(b){return null===b?b:j(b.first,h(n,i(b)))},v=function e(d,
c,a){return c>=a?null:l(d[c],h(e,d,c+1,a))},q=function(e,d){for(var c=d,a=0;null!==c;c=i(c))e(c.first,a),a+=1},r=function(e,d,c){var a=d;q(function(c,d){return a=e(a,c,d)},c);return a},w=h(function d(c,a,f,g){return null===g?f:a(d(c+1,a,f,i(g)),g.first,c)},0),x=function(d,c){d.push(c);return d},s=h(function c(a,f,g){return null===g?g:l(f(g.first,a),h(c,a+1,f,i(g)))},0),y=h(function a(f,g,k){for(;null!==k;k=i(k)){var j=k.first;if(g(j,f))return l(j,h(a,f+1,g,i(k)));f+=1}return k},0);return{end:null,
stream:m,memoStream:l,cons:function(a,f){return m(a,p(f))},append:function(){return t(arguments,u,null)},appendz:j,concat:n,from:function(a){return v(a,0,a.length)},first:function(a){return a.first},rest:i,isEmpty:function(a){return null===a},isStream:function(a){return a&&a.hasOwnProperty("first")&&a.hasOwnProperty("rest")||null===a},forEach:q,foldl:r,foldr:w,toArray:function(a){return r(x,[],a)},map:s,filter:y,bind:function(a,f){return n(s(a,f))}}});
