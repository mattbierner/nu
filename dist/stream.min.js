define(function(){var t=Array.prototype.reduce,h=function(b){return 1===arguments.length?b:b.bind.apply(b,arguments)},n=h(h,function(b){return b}),k=function(b,d){return{first:b,rest:d}},m=function(b,d){var f;return{first:b,rest:function(){return void 0===f?f=d.apply(void 0,arguments):f}}},j=function(b,d){return null===b?d():k(b.first,h(j,i(b),d))},p=function(b,d){return j(b,n(d))},q=function(b,d,f){return d>=f?null:m(b[d],h(q,b,d+1,f))},i=function(b){return b.rest(b.first)},r=function(b,d,f){for(var e=
0;null!==b;)d.call(f,b.first,e),++e,b=i(b)},s=h(function d(f,e,a,c){if(null===e)return c;if(void 0===c)return d(1,i(e),a,e.first);r(e,function(d,e){c=a(c,d,e+f)});return c},0),u=h(function f(e,a,c,g){if(null===a)return g;var h=a.first,a=i(a);return null===a&&void 0===g?h:c(f(e+1,a,c,g),h,e)},0),v=function(f,e){f.push(e);return f},w=h(function e(a,c,g,l){return null===c?c:m(g.call(l,c.first,a),h(e,a+1,i(c),g,l))},0),x=h(function a(c,g,l,k){for(;null!==g;){var j=g.first;if(l.call(g,j,c))return m(j,
h(a,c+1,i(g),l,k));++c;g=i(g)}return g},0);return{end:null,stream:k,memoStream:m,cons:function(a,c){return k(a,n(c))},concat:p,concatz:j,concata:function(){return 0===arguments.length?null:t.call(arguments,p)},from:function(a){return void 0===a?null:q(a,0,a.length)},first:function(a){return a.first},rest:i,isEmpty:function(a){return null===a},isStream:function(a){return a&&a.hasOwnProperty("first")&&a.hasOwnProperty("rest")},forEach:r,reduce:s,reduceRight:u,toArray:function(a){return s(a,v,[])},map:w,
filter:x}});
