define(function(){var t=Function.prototype.call.bind(Array.prototype.reduce),g=function(b){return b.bind.apply(b,arguments)},n=function(b){return function(){return b}},l=function(b,c){return{first:b,rest:c}},k=function(b,c){var d;return l(b,function(){void 0===d&&(d=c.apply(this,arguments));return d})},h=function(b){return b.rest(b.first)},i=function(b,c){return null===b?c():k(b.first,g(i,h(b),c))},u=function(b,c){return i(b,n(c))},m=function(b){return null===b?b:i(b.first,g(m,h(b)))},p=function(b,
c,d){return c>=d?null:k(b[c],g(p,b,c+1,d))},q=function(b,c){for(var d=c,a=0;null!==d;d=h(d))b(d.first,a),a+=1},r=function(b,c,d){var a=c;q(function(c,d){return a=b(a,c,d)},d);return a},v=g(function c(d,a,e,f){return null===f?e:a(c(d+1,a,e,h(f)),f.first,d)},0),w=function(c,d){c.push(d);return c},s=g(function d(a,e,f){return null===f?f:k(e(f.first,a),g(d,a+1,e,h(f)))},0),x=g(function a(e,f,j){for(;null!==j;j=h(j)){var i=j.first;if(f(i,e))return k(i,g(a,e+1,f,h(j)));e+=1}return j},0);return{end:null,
stream:l,memoStream:k,cons:function(a,e){return l(a,n(e))},append:function(){return t(arguments,u,null)},appendz:i,concat:m,from:function(a){return p(a,0,a.length)},first:function(a){return a.first},rest:h,isEmpty:function(a){return null===a},isStream:function(a){return a&&a.hasOwnProperty("first")&&a.hasOwnProperty("rest")||null===a},forEach:q,foldl:r,foldr:v,toArray:function(a){return r(w,[],a)},map:s,filter:x,bind:function(a,e){return m(s(a,e))}}});
