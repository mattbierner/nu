define(function(){var t=Array.prototype.reduce,e=function(a){return 1===arguments.length?a:a.bind.apply(a,arguments)},n=e(e,function(a){return a}),l=function(a,c){return{first:a,rest:c}},k=function(a,c){var d;return{first:a,rest:function(){return void 0===d?d=c.apply(void 0,arguments):d}}},h=function(a,c){return null===a?c():l(a.first,e(h,g(a),c))},u=function(a,c){return h(a,n(c))},m=function(a){return null===a?a:h(a.first,e(m,g(a)))},p=function(a,c,d){return c>=d?null:k(a[c],e(p,a,c+1,d))},g=function(a){return a.rest(a.first)},
q=function(a,c){for(var d=0;null!==a;)c(a.first,d),++d,a=g(a)},r=function(a,c,d){q(d,function(b,d){return c=a(c,b,d)});return c},v=e(function c(d,b,f,e){return null===e?f:b(c(d+1,b,f,g(e)),e.first,d)},0),w=e(r,function(c,d){return c.concat(d)},[]),s=e(function d(b,f,i){return null===i?i:k(f(i.first,b),e(d,b+1,f,g(i)))},0),x=e(function b(f,i,j){for(;null!==j;){var h=j.first;if(i(h,f))return k(h,e(b,f+1,i,g(j)));++f;j=g(j)}return j},0);return{end:null,stream:l,memoStream:k,cons:function(b,e){return l(b,
n(e))},append:function(){return 0===arguments.length?null:t.call(arguments,u)},appendz:h,concat:m,from:function(b){return void 0===b?null:p(b,0,b.length)},first:function(b){return b.first},rest:g,isEmpty:function(b){return null===b},isStream:function(b){return b&&b.hasOwnProperty("first")&&b.hasOwnProperty("rest")},forEach:q,foldl:r,foldr:v,toArray:w,map:s,filter:x,bind:function(b,e){return m(s(b,e))}}});
